<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test Circle Configuration</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white p-8">
  <div class="max-w-2xl mx-auto">
    <h1 class="text-3xl font-bold mb-6">üîµ Circle Configuration Test</h1>

    <div class="bg-gray-800 rounded-lg p-6 mb-6">
      <h2 class="text-xl font-semibold mb-4">Check Supabase Secrets</h2>
      <button
        onclick="testCircleConfig()"
        class="bg-blue-600 hover:bg-blue-700 px-6 py-3 rounded-lg font-semibold transition"
      >
        Test Configuration
      </button>
    </div>

    <div id="results" class="space-y-4"></div>
  </div>

  <script>
    async function testCircleConfig() {
      const resultsDiv = document.getElementById('results');
      resultsDiv.innerHTML = '<div class="bg-gray-800 p-4 rounded">Testing...</div>';

      try {
        // Test edge function to see what it returns
        const response = await fetch(
          'https://kujoudvjmhuypxyntrkm.supabase.co/functions/v1/circle-instant-payout',
          {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              walletAddress: '0x0000000000000000000000000000000000000001' // test address
            })
          }
        );

        const data = await response.json();

        let html = '<div class="bg-gray-800 rounded-lg p-6">';
        html += '<h3 class="text-lg font-semibold mb-4">Test Results</h3>';
        html += `<div class="mb-4"><strong>Status:</strong> ${response.status}</div>`;

        if (data.error) {
          if (data.error.includes('not configured')) {
            html += '<div class="bg-red-900/50 border border-red-500 rounded p-4 mb-4">';
            html += '<p class="font-semibold text-red-300">‚ùå Circle Not Configured</p>';
            html += '<p class="text-sm mt-2">Missing in Supabase Secrets:</p>';
            html += '<ul class="list-disc list-inside mt-2 text-sm">';
            html += '<li>VITE_CIRCLE_API_KEY</li>';
            html += '<li>CIRCLE_WALLET_ID</li>';
            html += '</ul>';
            html += '</div>';
          } else if (data.error === 'User not found') {
            html += '<div class="bg-green-900/50 border border-green-500 rounded p-4 mb-4">';
            html += '<p class="font-semibold text-green-300">‚úÖ Circle IS Configured!</p>';
            html += '<p class="text-sm mt-2">Got past configuration check. Error is expected (test wallet not in database).</p>';
            html += '</div>';
          } else {
            html += '<div class="bg-yellow-900/50 border border-yellow-500 rounded p-4 mb-4">';
            html += `<p class="font-semibold text-yellow-300">‚ö†Ô∏è Other Error: ${data.error}</p>`;
            html += '</div>';
          }
        } else {
          html += '<div class="bg-green-900/50 border border-green-500 rounded p-4 mb-4">';
          html += '<p class="font-semibold text-green-300">‚úÖ Success!</p>';
          html += '</div>';
        }

        html += '<details class="mt-4">';
        html += '<summary class="cursor-pointer text-blue-400">Show Full Response</summary>';
        html += `<pre class="bg-gray-900 p-4 rounded mt-2 overflow-auto text-xs">${JSON.stringify(data, null, 2)}</pre>`;
        html += '</details>';
        html += '</div>';

        // Check .env file values
        html += '<div class="bg-gray-800 rounded-lg p-6 mt-4">';
        html += '<h3 class="text-lg font-semibold mb-4">Local .env Check</h3>';
        html += '<p class="text-sm text-gray-400 mb-2">These are client-side values (not the Supabase secrets):</p>';

        const envVars = [
          'VITE_CIRCLE_API_KEY',
          'CIRCLE_WALLET_ID',
          'CIRCLE_ENTITY_SECRET'
        ];

        html += '<div class="space-y-2">';
        envVars.forEach(key => {
          const value = import.meta.env[key];
          const status = !value || value === 'not-configured' ? '‚ùå' : '‚úÖ';
          const displayValue = value ? (value.substring(0, 20) + '...') : 'Not set';
          html += `<div class="text-sm"><strong>${status} ${key}:</strong> ${displayValue}</div>`;
        });
        html += '</div>';
        html += '</div>';

        resultsDiv.innerHTML = html;

      } catch (error) {
        resultsDiv.innerHTML = `
          <div class="bg-red-900/50 border border-red-500 rounded p-4">
            <p class="font-semibold">‚ùå Error: ${error.message}</p>
          </div>
        `;
      }
    }
  </script>
</body>
</html>
