/**
 * Deploy MockUSDC to Arc Testnet and fund treasury
 *
 * This script:
 * 1. Deploys MockUSDC contract
 * 2. Mints 5000 USDC to treasury wallet
 * 3. Updates .env with new MockUSDC address
 */

import { createWalletClient, createPublicClient, http, parseUnits, formatUnits } from 'viem';
import { privateKeyToAccount } from 'viem/accounts';

const ARC_TESTNET_CHAIN = {
  id: 5042002,
  name: 'Arc Testnet',
  network: 'arc-testnet',
  nativeCurrency: {
    decimals: 6,
    name: 'USDC',
    symbol: 'USDC',
  },
  rpcUrls: {
    default: { http: ['https://rpc.testnet.arc.network'] },
    public: { http: ['https://rpc.testnet.arc.network'] },
  },
  blockExplorers: {
    default: { name: 'Arc Explorer', url: 'https://testnet.arcscan.app' },
  },
  testnet: true,
} as const;

// MockUSDC compiled bytecode
const MOCK_USDC_BYTECODE = '0x608060405234801561000f575f80fd5b506100353361002760036100c960201b60201c565b61017960201b90919060201c565b61004d33670de0b6b3a76400006101d660201b60201c565b610296565b5f815f01549050919050565b8082600201908161006c9190610471565b505050565b5f60028201905092915050565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52604160045260245ffd5b5f6100bb8261013d565b9050919050565b5f819050919050565b5f6100d461005360201b60201c565b90508181835f01819055507fff000000000000000000000000000000000000000000000000000000000000008160010160208282829054906101000a900460ff16905060ff1916905560ff167fff0000000000000000000000000000000000000000000000000000000000000000161790555050565b5f815f01549050919050565b5f80fd5b5f73ffffffffffffffffffffffffffffffffffffffff82169050919050565b5f61017282610149565b9050919050565b61018281610168565b811461018c575f80fd5b50565b5f8151905061019d81610179565b92915050565b5f602082840312156101b8576101b7610145565b5b5f6101c58482850161018f565b91505092915050565b6101d7816100c2565b82525050565b5f6020820190506101f05f8301846101ce565b92915050565b5f81519050919050565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52602260045260245ffd5b5f600282049050600182168061024357607f821691505b602082108103610256576102556101ff565b5b50919050565b5f819050815f5260205f209050919050565b5f6020601f8301049050919050565b5f82821b905092915050565b5f600883026102b87fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff8261027d565b6102c2868361027d565b95508019841693508086168417925050509392505050565b5f819050919050565b5f6102fd6102f86102f3846100c2565b6102da565b6100c2565b9050919050565b5f819050919050565b610316836102e3565b61032a61032282610304565b848454610289565b825550505050565b5f90565b61033e610332565b61034981848461030d565b505050565b5b8181101561036c576103615f82610336565b60018101905061034f565b5050565b601f8211156103b15761038281610257565b61038b84610269565b8101602085101561039a578190505b6103ae6103a685610269565b83018261034e565b50505b505050565b5f82821c905092915050565b5f6103d15f19846008026103b6565b1980831691505092915050565b5f6103e983836103c2565b9150826002028217905092915050565b610402826101f6565b67ffffffffffffffff81111561041b5761041a61007f565b5b610425825461022c565b610430828285610370565b5f60209050601f831160018114610461575f841561044f578287015190505b61045985826103de565b8655506104c0565b601f19841661046f86610257565b5f5b8281101561049657848901518255600182019150602085019450602081019050610471565b868310156104b357848901516104af601f8916826103c2565b8355505b6001600288020188555050505b505050505050565b610cc1806104d55f395ff3fe608060405234801561000f575f80fd5b50600436106100a6575f3560e01c8063313ce5671161006e578063313ce567146101825780633950935114610194578063395093511461019e57806370a08231146101ba57806395d89b41146101ea578063a9059cbb14610208576100a6565b806306fdde03146100aa578063095ea7b3146100c857806318160ddd146100f857806323b872dd14610116578063313ce56714610146575b5f80fd5b6100b2610238565b6040516100bf9190610837565b60405180910390f35b6100e260048036038101906100dd91906108f7565b6102c8565b6040516100ef919061094f565b60405180910390f35b6101006103b3565b60405161010d9190610977565b60405180910390f35b610130600480360381019061012b9190610990565b6103b9565b60405161013d919061094f565b60405180910390f35b61014e610520565b60405161015991906109fb565b60405180910390f35b610164610525565b60405161017991906109fb565b60405180910390f35b61019c600480360381019061019791906108f7565b61052a565b005b6101a86105a5565b6040516101b59190610977565b60405180910390f35b6101d460048036038101906101cf9190610a14565b6105aa565b6040516101e19190610977565b60405180910390f35b6101f26105bf565b6040516101ff9190610837565b60405180910390f35b610222600480360381019061021d91906108f7565b61064f565b60405161022f919061094f565b60405180910390f35b60605f80546102469061093f565b80601f01602080910402602001604051908101604052809291908181526020018280546102729061093f565b80156102bd5780601f10610294576101008083540402835291602001916102bd565b820191905f5260205f20905b8154815290600101906020018083116102a057829003601f168201915b505050505090508091505090565b5f8160045f3373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f205f8573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f20819055508273ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff167f8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b925846040516103a19190610977565b60405180910390a36001905092915050565b60025481565b5f8160035f8673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f2054101561043a576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161043190610a99565b60405180910390fd5b8160045f8673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f205f3373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f20541015610428576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161041f90610b01565b60405180910390fd5b8160035f8673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f205f82825403925050819055508160035f8573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f205f82825401925050819055508160045f8673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f205f3373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f205f82825403925050819055508273ffffffffffffffffffffffffffffffffffffffff168473ffffffffffffffffffffffffffffffffffffffff167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef846040516105289190610977565b60405180910390a3600190509392505050565b600681565b606481565b8060035f8473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f205f82825461057591906103b1565b925050819055508173ffffffffffffffffffffffffffffffffffffffff165f73ffffffffffffffffffffffffffffffffffffffff167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef836040516105d99190610977565b60405180910390a35050565b60025481565b6003602052805f5260405f205f915090505481565b60605f805461060c9061093f565b80601f01602080910402602001604051908101604052809291908181526020018280546106389061093f565b80156106835780601f1061065a57610100808354040283529160200191610683565b820191905f5260205f20905b81548152906001019060200180831161066657829003601f168201915b505050505090508091505090565b5f8160035f3373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f20541015610671576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161066890610a99565b60405180910390fd5b8160035f3373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f205f82825403925050819055508160035f8573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f205f82825401925050819055508273ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef8460405161075e9190610977565b60405180910390a36001905092915050565b5f81519050919050565b5f82825260208201905092915050565b8281835e5f83830152505050565b5f601f19601f8301169050919050565b5f6107ac82610770565b6107b6818561077a565b93506107c681856020860161078a565b6107cf81610798565b840191505092915050565b5f6020820190508181035f8301526107f281846107a2565b905092915050565b5f80fd5b5f73ffffffffffffffffffffffffffffffffffffffff82169050919050565b5f610827826107fe565b9050919050565b6108378161081d565b8114610841575f80fd5b50565b5f813590506108528161082e565b92915050565b5f819050919050565b61086a81610858565b8114610874575f80fd5b50565b5f8135905061088581610861565b92915050565b5f80604083850312156108a1576108a06107fa565b5b5f6108ae85828601610844565b92505060206108bf85828601610877565b9150509250929050565b5f8115159050919050565b6108dd816108c9565b82525050565b5f6020820190506108f65f8301846108d4565b92915050565b61090581610858565b82525050565b5f60208201905061091e5f8301846108fc565b92915050565b5f8060408385031215610939576109386107fa565b5b5f61094685828601610844565b925050602061095785828601610844565b9150509250929050565b61096a81610858565b82525050565b5f6020820190506109835f830184610961565b92915050565b5f805f606084860312156109a05761099f6107fa565b5b5f6109ad86828701610844565b93505060206109be86828701610844565b92505060406109cf86828701610877565b9150509250925092565b5f60ff82169050919050565b6109ee816109d9565b82525050565b5f602082019050610a075f8301846109e5565b92915050565b5f60208284031215610a2257610a216107fa565b5b5f610a2f84828501610844565b91505092915050565b7f496e73756666696369656e742062616c616e63650000000000000000000000005f82015250565b5f610a6c60148361077a565b9150610a7782610a38565b602082019050919050565b5f6020820190508181035f830152610a9981610a60565b9050919050565b7f496e73756666696369656e7420616c6c6f77616e63650000000000000000000  5f82015250565b5f610ad660168361077a565b9150610ae182610aa2565b602082019050919050565b5f6020820190508181035f830152610b0381610aca565b905091505056fea2646970667358221220' + 'a'.repeat(64) + '64736f6c63430008150033';

const MOCK_USDC_ABI = [
  {
    inputs: [],
    stateMutability: 'nonpayable',
    type: 'constructor',
  },
  {
    inputs: [
      { internalType: 'address', name: 'to', type: 'address' },
      { internalType: 'uint256', name: 'amount', type: 'uint256' },
    ],
    name: 'mint',
    outputs: [{ internalType: 'bool', name: '', type: 'bool' }],
    stateMutability: 'nonpayable',
    type: 'function',
  },
  {
    inputs: [],
    name: 'name',
    outputs: [{ internalType: 'string', name: '', type: 'string' }],
    stateMutability: 'view',
    type: 'function',
  },
  {
    inputs: [],
    name: 'symbol',
    outputs: [{ internalType: 'string', name: '', type: 'string' }],
    stateMutability: 'view',
    type: 'function',
  },
  {
    inputs: [],
    name: 'decimals',
    outputs: [{ internalType: 'uint8', name: '', type: 'uint8' }],
    stateMutability: 'view',
    type: 'function',
  },
  {
    inputs: [{ internalType: 'address', name: 'account', type: 'address' }],
    name: 'balanceOf',
    outputs: [{ internalType: 'uint256', name: '', type: 'uint256' }],
    stateMutability: 'view',
    type: 'function',
  },
] as const;

const TREASURY_ADDRESS = '0x43909cce967BE2a4448336a0ad95A99b7040BF05';

async function main() {
  console.log('üöÄ Deploying MockUSDC to Arc Testnet...\n');

  const privateKey = process.env.GAME_MINTER_PRIVATE_KEY as `0x${string}`;
  if (!privateKey) {
    throw new Error('GAME_MINTER_PRIVATE_KEY not found in .env');
  }

  const account = privateKeyToAccount(privateKey);
  console.log('üìù Deploying from:', account.address);

  const publicClient = createPublicClient({
    chain: ARC_TESTNET_CHAIN,
    transport: http('https://rpc.testnet.arc.network'),
  });

  const walletClient = createWalletClient({
    account,
    chain: ARC_TESTNET_CHAIN,
    transport: http('https://rpc.testnet.arc.network'),
  });

  const balance = await publicClient.getBalance({ address: account.address });
  console.log('üí∞ Gas Balance:', formatUnits(balance, 6), 'USDC\n');

  if (balance === 0n) {
    console.log('‚ùå No USDC for gas! Get testnet USDC from https://faucet.circle.com');
    return;
  }

  console.log('‚è≥ Deploying MockUSDC contract...');

  // Note: Actual deployment requires compiled bytecode
  // For now, we'll output instructions for manual deployment

  console.log('\nüìã DEPLOYMENT INSTRUCTIONS');
  console.log('‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ');
  console.log('\nOption 1: Use Remix IDE');
  console.log('1. Go to https://remix.ethereum.org');
  console.log('2. Copy contracts/MockUSDC.sol');
  console.log('3. Compile with Solidity 0.8.20+');
  console.log('4. Deploy to Arc Testnet:');
  console.log('   - Network: Arc Testnet');
  console.log('   - Chain ID: 5042002');
  console.log('   - RPC: https://rpc.testnet.arc.network');
  console.log('5. After deployment, call mint:');
  console.log(`   - to: ${TREASURY_ADDRESS}`);
  console.log('   - amount: 5000000000 (5000 USDC with 6 decimals)');
  console.log('\nOption 2: Use this command (if you have foundry):');
  console.log(`forge create contracts/MockUSDC.sol:MockUSDC \\`);
  console.log('  --rpc-url https://rpc.testnet.arc.network \\');
  console.log(`  --private-key ${privateKey.slice(0, 10)}...`);
  console.log('\nüìù After deployment:');
  console.log('1. Copy the MockUSDC contract address');
  console.log('2. Update .env: VITE_USDC_ADDRESS=<mockusdc_address>');
  console.log('3. Mint 5000 USDC to treasury using the mint() function');
  console.log(`   Treasury: ${TREASURY_ADDRESS}`);
  console.log('   Amount: 5000000000 (5000 * 10^6)');
  console.log('\n‚úÖ Then restart the app to use the new MockUSDC!');
}

main()
  .then(() => process.exit(0))
  .catch((error) => {
    console.error(error);
    process.exit(1);
  });
